"use strict";var app=angular.module("fancheerEMC",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ngIdle","ui.bootstrap","chart.js","nvd3","mwl.calendar","blueimp.fileupload"]),httpHeaders,loginMessage,spinner,mToHide=["usernameNotFound","emailNotFound","usernameFound","emailFound","loginSuccess","userAdded"],msg={},environment=2,endpointMap={GetControllersService:"GetControllersService/webresources/GetControllersService",GetGamesBetweenDatesService:"GetGamesBetweenDatesService/webresources/GetGamesBetweenDatesService",GetPromotionTriggersService:"GetPromotionTriggersService/webresources/GetPromotionTriggersService",PostPromotionService:"PostPromotionService/webresources/PostPromotionService",DeletePromotionService:"DeletePromotionService/webresources/DeletePromotionService",PostControllerAssignmentsService:"PostControllerAssignmentsService/webresources/PostControllerAssignmentsService",GetSportsService:"GetSportsService/webresources/GetSportsService",GetGamesOnDateService:"GetGamesOnDateService/webresources/GetGamesOnDateService",GetPromotionsOnDateService:"GetPromotionsOnDateService/webresources/GetPromotionsOnDateService",GetPromotionsBetweenDateService:"GetPromotionsBetweenDateService/webresources/GetPromotionsBetweenDateService",VersionService:"VersionService/webresources/VersionService"},apiRoot=["/","http://localhost:8080/FanCheerServiceREST/","http://services.fancheerinteractive.com:8080/","http://development.fancheerinteractive.com:8080/"],apiUrl=function(a){return apiRoot[environment]+endpoint(a)},endpoint=function(a){return endpointMap[a]};app.config(["$routeProvider","$httpProvider","KeepaliveProvider","IdleProvider","calendarConfigProvider",function(a,b,c,d,e){a.when("/",{templateUrl:"views/console/console.html"}).when("/console",{templateUrl:"views/console/console.html"}).when("/about",{templateUrl:"views/about.html"}).when("/contact",{templateUrl:"views/contact.html"}).when("/forgotten",{templateUrl:"views/account/forgotten.html",controller:"ForgottenCtrl"}).when("/issue",{templateUrl:"views/issue.html",controller:"IssueCtrl"}).when("/registration",{templateUrl:"views/account/registration.html",controller:"RegistrationCtrl"}).when("/account",{templateUrl:"views/account/account.html",controller:"AccountCtrl",resolve:{login:["LoginService",function(a){return a()}]}}).when("/resetPassword",{templateUrl:"views/account/registerResetPassword.html",controller:"RegisterResetPasswordCtrl",resolve:{isFirstSetup:function(){return!1}}}).when("/registrationSubmitted",{templateUrl:"views/account/registrationSubmitted.html"}).when("/login",{templateUrl:"views/account/login.html"}).otherwise({redirectTo:"/"}),b.interceptors.push(["$rootScope","$q",function(a,b){var c=function(a){if(a.data&&a.data.text&&a.data.type)if(401===a.status)loginMessage={text:a.data.text,type:a.data.type,show:!0,manualHandle:a.data.manualHandle};else if(503===a.status)msg={text:"server.down",type:"danger",show:!0,manualHandle:!0};else{msg={text:a.data.text,type:a.data.type,show:!0,manualHandle:a.data.manualHandle};for(var b=!1,c=0;c<mToHide.length&&!b;)msg.text===mToHide[c]&&(b=!0),c++;b===!0&&(msg.show=!1)}};return{response:function(a){return c(a),a||b.when(a)},responseError:function(a){return c(a),b.reject(a)}}}]),b.interceptors.push(["$rootScope","$q",function(a,b){return{response:function(a){return a||b.when(a)},responseError:function(c){if(401===c.status&&"api/accounts/cuser"!==c.config.url){var d=b.defer(),e={config:c.config,deferred:d};return a.requests401.push(e),a.$broadcast("event:loginRequired"),b.when(c)}return b.reject(c)}}}]),b.interceptors.push(["$rootScope","$q",function(a,b){return{response:function(a){return a||b.when(a)},responseError:function(c){if(401===c.status){if("api/accounts/cuser"!==c.config.url){var d=b.defer(),e={config:c.config,deferred:d};return a.requests401.push(e),a.$broadcast("event:loginRequired"),b.when(c)}}else 503===c.status;return b.reject(c)}}}]),b.interceptors.push(["$q",function(a){return{response:function(b){return spinner=!1,b||a.when(b)},responseError:function(b){return spinner=!1,a.reject(b)}}}]),d.idle(1800),d.timeout(30),c.interval(10);var f=function(a,b){return spinner=!0,a};b.defaults.transformRequest.push(f),httpHeaders=b.defaults.headers}]),app.run(["$rootScope","$location","$filter","$http","base64","userInfoService","$q",function(a,b,c,d,e,f,g){a.loginDialogShown=!1,a.serverUp=!1,a.username=null,a.password=null,a.apiUrl=function(a){return apiUrl(a)},a.debug=function(a){},a.msg=function(){return msg},a.loginMessage=function(){return loginMessage},a.showSpinner=function(){return spinner},a.requests401=[],a.$on("event:loginRequired",function(){a.showLoginDialog()}),a.$on("event:loginConfirmed",function(){var c,e=a.requests401,f=function(a){d(a.config).then(function(b){a.deferred.resolve(b)})};for(c=0;c<e.length;c+=1)f(e[c]);a.requests401=[],b.url("/console")}),a.$on("event:loginRequest",function(b,c,g){httpHeaders.common.Accept="application/json",httpHeaders.common.Authorization="Basic "+e.encode(c+":"+g),d.get("api/accounts/login").success(function(){httpHeaders.common.Authorization=null,d.get("api/accounts/cuser").success(function(b){f.setCurrentUser(b),a.$broadcast("event:loginConfirmed")})})}),a.$on("event:registerRequest",function(a){b.url("/registration")}),a.$on("event:logoutRequest",function(){httpHeaders.common.Authorization=null,f.setCurrentUser(null),d.get("j_spring_security_logout")}),a.$on("event:loginCancel",function(){httpHeaders.common.Authorization=null}),a.$on("$routeChangeStart",function(a,b){msg&&"false"===msg.manualHandle&&(msg.show=!1)}),a.loadUserFromCookie=function(){f.hasCookieInfo()===!0&&(f.loadFromCookie(),httpHeaders.common.Authorization=f.getHthd())},a.checkServer=function(b,c){var e=g.defer();return d.get(apiUrl("VersionService")).then(function(b){a.serverUp=!0},function(b){msg={text:"server.down",type:"danger",show:!0,manualHandle:!0},a.serverUp=!1}),e.promise},a.checkServer()}]),angular.module("fancheerEMC").factory("i18n",function(){var a,b=function(b){$.i18n.properties({name:"messages",path:"lang/",mode:"map",language:b,callback:function(){a=b}})};return b("en"),{setLanguage:b}}),angular.module("fancheerEMC").directive("msg",[function(){return{restrict:"EA",replace:!0,link:function(a,b,c){var d=c.key;c.keyExpr&&a.$watch(c.keyExpr,function(a){d=a,b.text($.i18n.prop(a))}),a.$watch("language()",function(a){b.text($.i18n.prop(d))})}}}]),angular.module("fancheerEMC").service("base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(b){for(var c,d,e,f,g,h="",i="",j="",k=0;k<b.length;)c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";return h},this.decode=function(b){var c,d,e,f,g,h="",i="",j="",k=0;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<b.length;)e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!==g&&(h+=String.fromCharCode(d)),64!==j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j=""}}),angular.module("fancheerEMC").factory("userInfo",["$resource",function(a){return a("api/accounts/cuser")}]),angular.module("fancheerEMC").factory("userLoaderService",["userInfo","$q",function(a,b){var c=function(){var c=b.defer();return a.get({},function(a){c.resolve(a)},function(){c.reject("Unable to fetch user info")}),c.promise};return{load:c}}]),angular.module("fancheerEMC").factory("userInfoService",["$cookieStore","userLoaderService",function(a,b){var c=null,d=!1,e=!1,f=null,g="",h=function(){f=a.get("userID"),g=a.get("username"),d=a.get("customer"),e=a.get("admin")},i=function(b){a.put("hthd",b)},j=function(b){return a.get("hthd")},k=function(){return""===a.get("username")?!1:!0},l=function(){return o()&&c.accountId?c.accountId.toString():"0"},m=function(){return e},n=function(){return d},o=function(){return null!=c&&c&&angular.isObject(c)?!0:!1},p=function(){o()||b.load().then(q)},q=function(a){c=a,null!=c&&angular.isObject(c)?(g=c.username,f=c.accountId,angular.isArray(c.authorities)&&angular.forEach(c.authorities,function(a,b){switch(a.authority){case"user":break;case"admin":e=!0;break;case"customer":d=!0}})):(d=!1,e=!1)},r=function(){return g};return{saveHthd:i,getHthd:j,hasCookieInfo:k,loadFromCookie:h,getAccountID:l,isAdmin:m,isCustomer:n,isAuthenticated:o,setCurrentUser:q,loadFromServer:p,getUsername:r}}]),angular.module("fancheerEMC").filter("yesno",[function(){return function(a){return a?"YES":"NO"}}]),angular.module("fancheerEMC").filter("bytes",[function(){return function(a,b){if(isNaN(parseFloat(a))||!isFinite(a))return"-";"undefined"==typeof b&&(b=1);var c=["bytes","kB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(b)+" "+c[d]}}]),angular.module("fancheerEMC").directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)&&b.isImage(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}]),angular.module("fancheerEMC").controller("MainCtrl",["$scope","$rootScope","i18n","$location","userInfoService","$modal","$filter","base64","$http","Idle","$q",function(a,b,c,d,e,f,g,h,i,j,k){function l(){b.warning&&(b.warning.close(),b.warning=null),b.timedout&&(b.timedout.close(),b.timedout=null)}a.selectPromoTab=function(a){},a.getPromosOnDate=function(a,c){var d=k.defer();return i.get(apiUrl("GetPromotionsOnDateService"),{params:{venueCode:c,date:a}}).then(function(a){var c={};try{c=angular.fromJson(a.data)}catch(e){}b.debug("GetPromotionsOnDateService"),void 0!==c.errorMessage&&""!==c.errorMessage&&null!==c.errorMessage?d.reject(c.errorMessage):d.resolve(c)},function(a){b.debug("Failed to get GetPromotionsOnDateService:"+a),d.reject(a.data)}),d.promise},a.getPromosBetweenDates=function(a,c,d){var e=k.defer();return i.get(apiUrl("GetPromotionsBetweenDateService"),{params:{venueCode:d,start:a,end:c}}).then(function(a){var c={};try{c=angular.fromJson(a.data)}catch(d){}b.debug("GetPromotionsBetweenDateService"),void 0!==c.errorMessage&&""!==c.errorMessage&&null!==c.errorMessage?e.reject(c.errorMessage):e.resolve(c)},function(a){b.debug("Failed to get GetPromotionsBetweenDateService:"+a),e.reject(a.data)}),e.promise},a.getGamesBetween=function(a,c){var d=k.defer();return i.get(apiUrl("GetGamesBetweenDatesService"),{params:{start:a,end:c}}).then(function(a){var c={};try{c=angular.fromJson(a.data)}catch(e){}b.debug("Polled GetGamesBetweenDatesService"),void 0!==c.errorMessage&&""!==c.errorMessage&&null!==c.errorMessage?d.reject(c.errorMessage):d.resolve(c)},function(a){b.debug("Failed to get GetGamesBetweenDatesService:"+a),d.reject(a.data)}),d.promise},a.getGamesOnDate=function(a){var c=k.defer();return i.get(apiUrl("GetGamesOnDateService"),{params:{date:a}}).then(function(a){var d={};try{d=angular.fromJson(a.data)}catch(e){}b.debug("Polled GetGamesOnDateService"),void 0!==d.errorMessage&&""!==d.errorMessage&&null!==d.errorMessage?c.reject(d.errorMessage):c.resolve(d)},function(a){b.debug("Failed to get GetGamesOnDateService:"+a),c.reject(a.data)}),c.promise},a.language=function(){return c.language},a.setLanguage=function(a){c.setLanguage(a)},a.activeWhen=function(a){return a?"active":""},a.activeIfInList=function(a,b){var c=!1;if(angular.isArray(b)===!1)return"";for(var d=0;d<b.length&&c===!1;){if(b[d]===a)return"active";d++}return""},a.path=function(){return d.url()},a.login=function(){a.$emit("event:loginRequest",a.username,a.password)},a.loginReq=function(){b.loginMessage()&&(b.loginMessage().text="",b.loginMessage().show=!1),a.$emit("event:loginRequired")},a.logout=function(){e.setCurrentUser(null),a.username=a.password=null,a.$emit("event:logoutRequest"),d.url("/console")},a.cancel=function(){a.$emit("event:loginCancel")},a.isAuthenticated=function(){return e.isAuthenticated()},a.isCustomer=function(){return e.isCustomer()},a.isAdmin=function(){return e.isAdmin()},a.getRoleAsString=function(){return a.isCustomer()===!0?"customer":a.isAdmin()===!0?"Admin":"undefined"},a.getUsername=function(){return e.isAuthenticated()===!0?e.getUsername():""},a.getAccountID=function(){return e.getAccountID()},b.showLoginDialog=function(a,c){b.username=a,b.password=c,d.path("/login")},b.started=!1,j.watch(),b.$on("IdleStart",function(){l(),b.warning=f.open({templateUrl:"warning-dialog.html",windowClass:"modal-danger"})}),b.$on("IdleEnd",function(){l()}),b.$on("IdleTimeout",function(){l(),a.isAuthenticated&&a.logout(),b.timedout=f.open({templateUrl:"timedout-dialog.html",windowClass:"modal-danger"})}),b.start=function(){l(),j.watch(),b.started=!0},b.stop=function(){l(),j.unwatch(),b.started=!1},a.checkForIE=function(){var a={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!==c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!==b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};if(a.init(),"Explorer"===a.browser);},b.$watch(function(){return d.path()},function(a,c){b.setActive(a)}),b.api=function(a){return a},b.isActive=function(a){return a===b.activePath},b.setActive=function(a){""===a||"/"===a?d.path("/home"):b.activePath=a},a.getPromoTriggers=function(){var a=k.defer();return i.get(apiUrl("GetPromotionTriggersService"),{params:{}}).then(function(c){var d={};try{d=angular.fromJson(c.data)}catch(e){}b.debug("Polled GetPromotionTriggersService"),void 0!==d.errorMessage&&""!==d.errorMessage&&null!==d.errorMessage?a.reject(d.errorMessage):a.resolve(d)},function(c){b.debug("Failed to get GetPromotionTriggersService:"+c),a.reject(c.data)}),a.promise},a.postPromo=function(a){var c=k.defer();return i.post(apiUrl("PostPromotionService"),a,{}).then(function(a){var d={};try{d=angular.fromJson(a.data)}catch(e){}b.debug("Polled PostPromotionService"),void 0!==d.errorMessage&&""!==d.errorMessage&&null!==d.errorMessage?c.reject(d.errorMessage):c.resolve(d)},function(a){b.debug("Failed to PostPromotionService:"+a),c.reject(a.data)}),c.promise},a.deletePromo=function(a){var c=k.defer();return i.get(apiUrl("DeletePromotionService"),{params:{promoId:a}}).then(function(a){var d={};try{d=angular.fromJson(a.data)}catch(e){}b.debug("Polled DeletePromotionService"),void 0!==d.errorMessage&&""!==d.errorMessage&&null!==d.errorMessage?c.reject(d.errorMessage):c.resolve(d)},function(a){b.debug("Failed to DeletePromotionService:"+a),c.reject(a.data)}),c.promise},a.getSports=function(){var a=k.defer();return i.get(apiUrl("GetSportsService")).then(function(c){var d={};try{d=angular.fromJson(c.data)}catch(e){}b.debug("Polled GetSportsService"),void 0!==d.errorMessage&&""!==d.errorMessage&&null!==d.errorMessage?a.reject(d.errorMessage):a.resolve(d)},function(c){b.debug("Failed to get GetSportsService:"+c),a.reject(c.data)}),a.promise},a.saveController=function(a){var c=k.defer();return i.get(apiUrl("PostControllerAssignmentsService"),{params:a}).then(function(a){var d={};try{d=angular.fromJson(a.data)}catch(e){}b.debug("PostControllerAssignmentsService"),void 0!==d.errorMessage&&""!==d.errorMessage&&null!==d.errorMessage?c.reject(d.errorMessage):c.resolve(d)},function(a){b.debug("Failed to get PostControllerAssignmentsService:"+a),c.reject(a.data)}),c.promise},a.savePromo=function(a){var c=k.defer();return i.get(apiUrl("PostPromotionService"),{params:a}).then(function(a){var d={};try{d=angular.fromJson(a.data)}catch(e){}b.debug("PostPromotionService"),void 0!==d.errorMessage&&""!==d.errorMessage&&null!==d.errorMessage?c.reject(d.errorMessage):c.resolve(d)},function(a){b.debug("Failed to get PostPromotionService:"+a),c.reject(a.data)}),c.promise},a.getControllers=function(a){var c=k.defer();return i.get(apiUrl("GetControllersService"),{params:{venueCode:a}}).then(function(a){var d={};try{d=angular.fromJson(a.data)}catch(e){}b.debug("GetControllersService"),void 0!==d.errorMessage&&""!==d.errorMessage&&null!==d.errorMessage?c.reject(d.errorMessage):c.resolve(d)},function(a){b.debug("Failed to get GetControllersService:"+a),c.reject(a.data)}),c.promise},a.getTodaysGames=function(){var a=k.defer();return i.get(apiUrl("TodaysGamesService"),{params:{date:date}}).then(function(c){var d={};try{d=angular.fromJson(c.data)}catch(e){}b.debug("Polled TodaysGame for date "+date),void 0!==d.errorMessage&&""!==d.errorMessage&&null!==d.errorMessage?a.reject(d.errorMessage):a.resolve(d)},function(c){b.debug("Failed to get TodaysGame:"+c),a.reject(c.data)}),a.promise}}]),angular.module("fancheerEMC").controller("LoginCtrl",["$scope","$rootScope",function(a,b){a.user={username:b.username,password:b.password},a.cancel=function(){},a.login=function(){a.$emit("event:loginRequest",a.user.username,a.user.password)},a.register=function(){a.$emit("event:registerRequest")}}]),angular.module("fancheerEMC").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("fancheerEMC").controller("ConsoleCtrl",["$scope","$modal","$q","$http","$rootScope","$compile","AccountLoader","userInfoService",function(a,b,c,d,e,f,g,h){function i(a,b){return new Date(b,a,0).getDate()}function j(a){return k(a)+6}function k(a){return a.getDate()-a.getDay()}function l(a){return a.replace(/-/g,"/")}function m(a){var b=new Date(l(a.substring(0,19))+" UTC");return b}a.gamesError=null,a.msg={},a.promo=null,a.promoCopy=null,a.promoTriggers=[],a.promos=[],a.sports=[],a.calendarEvents=[],a.calendarLoading=!1,a.calendarError=null,a.promosLoading=!1,a.sportsLoading=!1,a.sportsError=null,a.promoEvents=[],a.dayElement=null,a.dayGames=[],a.controllerAssignmentLoading=!1,a.account=null,a.loadingSportGames=!1,a.controllers=[],a.controllersCopy=[],a.controllerAssignments=[],a.controllerId=null,a.tmpControllers=[].concat(a.controllers),a.todayGames={},a.sportsGames={},a.controllerAssignmentError=null,a.promoError={text:"",type:"",show:!1},a.format="yyyy-MM-dd",a.hstep=1,a.mstep=15,a.isStartDateMeridian=!0,a.isEndDateMeridian=!0,a.startDateOpened=!1,a.endDateOpened=!1,a.saving=!1;new Date;a.todayDate=new Date,a.savingControllerAssignments=!1,a.dateOptions={formatYear:"yy",startingDay:1},a.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]},a.uploadOptions={acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,previewSourceFileTypes:"/^image/(gif|jpeg|png)$/",paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.file=null,a.data=null,a.changeTo="Hungarian",a.tmpPromos=[],a.currentView=null,a.calendarView="month",a.calendarDay=new Date,a.calendarTitle="Promotions Calendar",a.currentEvent=null,a.calendarStarDate=null,a.calendarEndDate=null,a.eventClicked=function(b){a.editEvent(b)},a.editEvent=function(b){b.type="warning",null!=a.currentEvent&&(a.currentEvent.type="info"),a.currentEvent=b,a.editPromo(a.eventToPromo(b))},a.editPromo=function(b){a.saving=!1,a.promoError={text:"",type:"",show:!1},a.promo=b,a.data=null,a.file=null,a.getDayGames(a.calendarDay)},a.eventEdited=function(b){a.editEvent(b)},a.updateEvents=function(){if(null!=a.account){switch(a.calendarView){case"year":a.calendarStarDate=new Date(a.calendarDay.getFullYear(),0,1),a.calendarEndDate=new Date(a.calendarDay.getFullYear(),11,31,23,59,59);break;case"month":a.calendarStarDate=new Date(a.calendarDay.getFullYear(),a.calendarDay.getMonth(),1),a.calendarEndDate=new Date(a.calendarDay.getFullYear(),a.calendarDay.getMonth(),i(a.calendarDay.getMonth(),a.calendarDay.getFullYear()),23,59,59);break;case"week":a.calendarStarDate=new Date(a.calendarDay.getFullYear(),a.calendarDay.getMonth(),k(a.calendarDay)),a.calendarEndDate=new Date(a.calendarDay.getFullYear(),a.calendarDay.getMonth(),j(a.calendarDay),23,59,59);break;case"day":a.calendarStarDate=new Date(a.calendarDay.toDateString()),a.calendarStarDate.setHours(0),a.calendarStarDate.setMinutes(0),a.calendarStarDate.setSeconds(0),a.calendarEndDate=new Date(a.calendarDay.toDateString()),a.calendarEndDate.setHours(23),a.calendarEndDate.setMinutes(59),a.calendarEndDate.setSeconds(59)}a.calendarError=null,a.getPromosBetweenDates(a.calendarStarDate,a.calendarEndDate,a.account.venue).then(function(b){a.setEvents(b),a.getDayGames(a.calendarDay)},function(b){a.calendarError="ERROR: Cannot load the events",a.setEvents([])})}},a.eventToPromo=function(a){return angular.copy({promoId:a.id,promoText:a.title,imageFileName:a.imageFileName,promoStartDate:new Date(a.startsAt),promoEndDate:new Date(a.endsAt),promoTrigger:a.promoTrigger,promoEvent:a.promoEvent,promoDuration:a.promoDuration,promoDescription:a.promoDescription})},a.promoToEvent=function(a){var b=m(a.promoStartDate),c=a.promoEndDate&&null!=a.promoEndDate&&""!==a.promoEndDate?m(a.promoEndDate):b,d={id:a.promoId,title:a.promoText,promoText:a.promoText,type:"info",imageFileName:a.imageFileName,startsAt:b,endsAt:c,editable:!0,deletable:!0,draggable:!1,resizable:!1,incrementsBadgeTotal:!0,cssClass:"a-css-class-name",promoDescription:a.promoDescription,promoTrigger:a.promoTrigger,promoEvent:a.promoEvent,promoDuration:a.promoDuration};return d},a.getEventTitle=function(a){return a.promoText+":"+$filter("date")(a.startsAt,"short")+" - "+$filter("date")(a.endsAt,"short")},a.update=function(a,b){a.id=b.promoId,a.title=b.promoText,a.type="info",a.imageFileName=b.imageFileName,a.startsAt=b.promoStartDate,a.endsAt=b.promoEndDate,a.promoDescription=b.promoDescription,a.promoTrigger=b.promoTrigger,a.promoEvent=b.promoEvent,a.promoDuration=b.promoDuration},a.toggle=function(b,c){b.preventDefault(),b.stopPropagation(),a.currentEvent[c]=!a.currentEvent[c]},a.load=function(){"0"!=h.getAccountID()&&new g(h.getAccountID()).then(function(b){a.account=b,a.updateEvents(),a.getControllers(a.account.venue).then(function(b){a.controllers=b,a.tmpControllers=[].concat(a.controllers),a.controllersCopy=angular.copy(a.controllers)},function(b){a.controllers=[],a.tmpControllers=[].concat(a.controllers),a.controllerAssignmentError=b,a.controllersCopy=[]})},function(){a.controllers=[],a.tmpControllers=[].concat(a.controllers),a.controllersCopy=angular.copy(a.controllers)})},a.$on("event:loginConfirmed",function(b){a.load()}),a.$on("fileuploadadd",function(b,c){a.data=c,(c.autoUpload||c.autoUpload!==!1)&&c.process().done(function(){a.file=c.files[0]})}),a.$watch("calendarDay",function(b){a.updateEvents();a.calendarEvents}),a.$watch("calendarView",function(b){a.updateEvents();a.calendarEvents}),a.init=function(){a.getPromoTriggers().then(function(b){a.promoTriggers=b},function(b){a.promoTriggers=[],a.error=b}),a.getSports().then(function(b){a.sports=b},function(b){a.sports=[],a.error=b}),a.load()},a.findPromo=function(b){for(var c=0;c<a.tmpPromos.length;c++)if(a.tmpPromos[c].promoId===b)return a.tmpPromos[c];return void 0},a.getPromoImage=function(b){return null!=b?a.getImage(b.imageFileName):null},a.getImage=function(a){return null!=a&&""!=a?apiRoot[environment]+"uploaded_promos/"+a:null},a.setEvents=function(b){if(a.calendarEvents.length=0,b.length>0)for(var c=0;c<b.length;c++)a.calendarEvents.push(a.promoToEvent(b[c]))},a.getSportGames=function(b){var c=[];return angular.forEach(a.games,function(a){a.game.sportId===b&&c.push(a)}),c},a.getDayGames=function(b){a.gamesLoading=!0,a.gamesError=null,a.getGamesOnDate(b).then(function(b){for(var c=0;c<b.length;c++){var d=b[c].game;d.startTime=m(d.startTime)}a.games=b,a.gamesBySports={};for(var c=0;c<a.sports.length;c++)a.gamesBySports[a.sports[c].sportId]=a.getSportGames(a.sports[c].sportId);a.gamesLoading=!1},function(b){a.games=[],a.gamesError=b,a.gamesLoading=!1})},a.fetchEvents=function(){},a.createPromo=function(){var b={promoId:null,promoText:null,imageFileName:null,promoStartDate:(new Date).toUTCString(),promoEndDate:(new Date).toUTCString(),promoTrigger:null,promoEvent:null,promoDuration:600,promoDescription:null};a.currentEvent=a.promoToEvent(b),a.editPromo(b)},a.deleteCurrentPromo=function(){a.promoError={text:"",type:"",show:!1,manualHandle:!0},a.deletePromo(a.promo.promoId).then(function(b){var c=a.calendarEvents.indexOf(a.currentEvent);c>=0&&a.calendarEvents.splice(c,1),a.promo=null,a.saving=!1},function(b){a.promoError={text:"promoDeleteFailed",type:"danger",show:!0,manualHandle:!0}})},a.eventDeleted=function(b){a.deletePromo(b.id).then(function(c){var d=a.calendarEvents.indexOf(b);d>=0&&a.calendarEvents.splice(d,1)},function(a){msg={text:"promoDeleteFailed",type:"danger",show:!0,manualHandle:!0}})},a.copy=function(a){return angular.copy(a)},a.clone=function(b){var c=a.copy(b);c.promoId=null,a.editPromo(c)},a.save=function(){if(null!=a.data){a.saving=!0,a.data.url="api/promo/uploadImage";a.data.submit().success(function(b,c,d){a.promo.imageFileName=b,a.saveCurrentPromo()}).error(function(b,c,d){a.promoError.show=!0,a.promoError.text="promoImageSaveFailed",a.promoError.type="danger",a.saving=!1})}else a.saveCurrentPromo()},a.saveCurrentPromo=function(){a.promo.venueCode=a.account.venue,a.savePromo(a.promo).then(function(b){(!a.currentEvent.id||a.currentEvent.id<0||a.calendarEvents.indexOf(a.currentEvent)<0)&&a.calendarEvents.push(a.currentEvent),a.update(a.currentEvent,a.promo),a.promoError.text="promoSaveSuccess",a.promoError.type="success",a.promoError.show=!0,a.saving=!1},function(b){a.promoError.text=b,a.promoError.type="danger",a.promoError.show=!0,a.saving=!1})},a.close=function(){a.currentEvent.type="info",delete a.currentEvent.startOpen,delete a.currentEvent.endOpen,a.promo=null,a.data=null,a.file=null,a.promoCopy=null},a.cancel=function(){a.close(),a.currentEvent=null},a.saveControllerAssignments=function(){if(null!=a.controllerAssignments&&a.controllerAssignments.length>0){a.savingControllerAssignments=!0,a.controllerAssignmentInfo=null;for(var b=!0,c=0;c<a.controllerAssignments.length;c++){a.savingControllerAssignments=!0;var d=a.controllerAssignments[c];delete d.errorMessage,delete d.message,a.saveController(d).then(function(a){b=b&&!0,d.message=a.message},function(a){d.errorMessage=a,b=!1})}a.savingControllerAssignments=!1,b&&(a.controllerAssignments=[],a.controllerAssignmentInfo="Controller Saved Successfully!")}},a.findControllerAssignment=function(b){a.controllerAssignments&&0!==a.controllerAssignments.length||(a.controllerAssignments=[]);var c=null;return angular.forEach(a.controllerAssignments,function(a){a.controllerId===b.netvControllerId&&(c=a)}),null===c&&(c={controllerId:b.netvControllerId,gameId:b.gameId},a.controllerAssignments.push(c)),c},a.gameLabel=function(a){return a.homeTeam.shortName+" vs "+a.awayTeam.shortName},a.setSportGames=function(b){a.sportsGames[b]=a.getSportGames(b)},a.recordGameAssignment=function(b){var c=a.findControllerAssignment(b);c.gameId=b.gameId}}]),angular.module("fancheerEMC").controller("ConfirmDeletePromoCtrl",["$scope","$modalInstance","selectedEvent","$q","$http","$rootScope",function(a,b,c,d,e,f){a.selectedEvent=c,a.loading=!1,a.error=null,a["delete"]=function(){a.loading=!0,f.deletePromo(a.selectedEvent.id).then(function(c){a.loading=!1,b.close(a.selectedEvent)},function(b){a.loading=!1,a.error="promoDeleteFailed"})},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("fancheerEMC").controller("ChartsCtrl",["$scope","$interval",function(a,b){function c(a,b,c){function e(a){for(var c=1/(.1+Math.random()),d=2*Math.random()-.5,e=10/(.1+Math.random()),f=0;b>f;f++){var g=(f/b-d)*e;a[f]+=c*Math.exp(-g*g)}}return arguments.length<3&&(c=0),d3.range(a).map(function(){var a,f=[];for(a=0;b>a;a++)f[a]=c+c*Math.random();for(a=0;5>a;a++)e(f);return f.map(d)})}function d(a,b){return{x:b,y:Math.max(0,a)}}a.msg={},a.genderOptions={chart:{type:"discreteBarChart",height:200,margin:{top:20,right:20,bottom:60,left:55},x:function(a){return a.label},y:function(a){return a.value},showValues:!0,valueFormat:function(a){return d3.format(",d")(a)},transitionDuration:500,xAxis:{axisLabel:"Gender"},yAxis:{axisLabel:"Total Number",axisLabelDistance:30}}},a.genderData=[{key:"Gender",values:[{label:"Female",value:Math.floor(500*Math.random())},{label:"Male",value:Math.floor(500*Math.random())}]}],a.ageOptions={chart:{type:"discreteBarChart",height:200,margin:{top:20,right:20,bottom:60,left:55},x:function(a){return a.label},y:function(a){return a.value},showValues:!0,valueFormat:function(a){return d3.format(",d")(a)},transitionDuration:500,xAxis:{axisLabel:"Age Range"},yAxis:{axisLabel:"Total Number",axisLabelDistance:30}}},a.ageData=[{key:"Cumulative Return",values:[{label:"[13-17]",value:Math.floor(500*Math.random())},{label:"[18-34]",value:Math.floor(500*Math.random())},{label:"[35-43]",value:Math.floor(500*Math.random())},{label:"[44-54]",value:Math.floor(500*Math.random())},{label:"[55-67]",value:Math.floor(500*Math.random())},{label:"[67+]",value:Math.floor(500*Math.random())}]}],a.zipCodeOptions={chart:{type:"scatterChart",height:450,color:d3.scale.category10().range(),scatter:{onlyCircles:!1},showDistX:!0,showDistY:!0,tooltipContent:function(a){return"<h3>"+a+"</h3>"},transitionDuration:350,xAxis:{axisLabel:"Last Customer Time",tickFormat:function(a){return d3.time.format("%x %H:%M:%S")(new Date(a))}},yAxis:{axisLabel:"Number of Customers",tickFormat:function(a){return d3.format(".d")(a)},axisLabelDistance:30}}},a.zData=[{key:"21704",value:Math.floor(1e3*Math.random()),time:"1136005200000"},{key:"22907",value:Math.floor(1e3*Math.random()),time:"1138683600000"},{key:"19007",value:Math.floor(1e3*Math.random()),time:"1341102800000"},{key:"14005",value:Math.floor(1e3*Math.random()),time:"1143781200000"},{key:"28201",value:Math.floor(1e3*Math.random()),time:"1546369600000"},{key:"15001",value:Math.floor(1e3*Math.random()),time:"1851640000000"},{key:"22001",value:Math.floor(1e3*Math.random()),time:"1954318400000"},{key:"22003",value:Math.floor(1e3*Math.random()),time:"1656996800000"},{key:"22004",value:Math.floor(1e3*Math.random()),
time:"1154283200000"},{key:"22006",value:Math.floor(1e3*Math.random()),time:"1059557200000"}],a.options={chart:{type:"multiChart",height:450,margin:{top:30,right:60,bottom:50,left:70},color:d3.scale.category10().range(),transitionDuration:500,xAxis:{tickFormat:function(a){return d3.format(",f")(a)}},yAxis1:{tickFormat:function(a){return d3.format(",.1f")(a)}}}},a.streams=["Engagement","Promos"],a.zipCodeData=[],a.data=[],a.generateZipData=function(b,c){for(var d=[],e=(d3.random.normal(),0);e<a.zData.length;e++){var f=a.zData[e],g={key:f.key,values:[]};g.values.push({x:f.time,y:f.value,size:10*f.value,shape:"circle"}),d.push(g)}return d},a.refreshAllCharts=function(){b(function(){angular.forEach(a.ageData[0].values,function(a){a.value=Math.floor(500*Math.random())}),angular.forEach(a.zipCodeData[0].values,function(a){a.y=Math.floor(360*Math.random())}),angular.forEach(a.genderData[0].values,function(a){a.value=Math.floor(500*Math.random())})},5e3)},a.generateEngagementData=function(){var b=c(2,10+100*Math.random(),.1).map(function(b,c){return{key:a.streams[c],values:b.map(function(a){return a.y=1*a.y,a})}});return b[0].type="bar",b[0].yAxis=1,b[1].type="line",b[1].yAxis=1,b},a.init=function(){a.zipCodeData=a.generateZipData(4,10),a.data=a.generateEngagementData(),a.refreshAllCharts()}}]),angular.module("fancheerEMC").controller("EMCCtrl",["$scope",function(a){a.active="/promo_console",a.loading=!1,a.isActive=function(b){return b===a.active},a.setActive=function(b){a.active=b,a.loading=!1}}]),angular.module("fancheerEMC").directive("focus",[function(){return{restrict:"EAC",link:function(a,b,c){}}}]),angular.module("fancheerEMC").directive("passwordValidate",[function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(b){return a.pwdValidLength=b&&b.length>=7?"valid":void 0,a.pwdHasLowerCaseLetter=b&&/[a-z]/.test(b)?"valid":void 0,a.pwdHasUpperCaseLetter=b&&/[A-Z]/.test(b)?"valid":void 0,a.pwdHasNumber=b&&/\d/.test(b)?"valid":void 0,a.pwdValidLength&&a.pwdHasLowerCaseLetter&&a.pwdHasUpperCaseLetter&&a.pwdHasNumber?(d.$setValidity("pwd",!0),b):void d.$setValidity("pwd",!1)})}}}]),angular.module("fancheerEMC").directive("checkPassword",[function(){return{require:"ngModel",link:function(a,b,c,d){var e="#"+c.checkPassword;b.add(e).on("keyup",function(){a.$apply(function(){var a=b.val()===$(e).val();d.$setValidity("noMatch",a)})})}}}]),angular.module("fancheerEMC").directive("checkPoaDate",[function(){return{replace:!0,link:function(a,b,c,d){var e=b.find("#inputStartDate"),f=b.find("#inputEndDate"),g=e.inheritedData().$ngModelController,h=f.inheritedData().$ngModelController,i=function(){var a=new Date(e.val()),b=new Date(f.val());b>a?(g.$setValidity("datesOK",!0),h.$setValidity("datesOK",!0)):(g.$setValidity("datesOK",!1),h.$setValidity("datesOK",!1))};e.on("change",i),f.on("change",i)}}}]),angular.module("fancheerEMC").directive("checkTimerange",[function(){return{replace:!0,link:function(a,b,c,d){var e,f,g,h,i=b.children(),j=i.find(".shour"),k=i.find(".sminute"),l=i.find(".ehour"),m=i.find(".eminute");e=j.inheritedData().$ngModelController,f=k.inheritedData().$ngModelController,g=l.inheritedData().$ngModelController,h=m.inheritedData().$ngModelController;var n=!0,o=function(){n&&(e.$setViewValue(e.$modelValue),f.$setViewValue(f.$modelValue),g.$setViewValue(g.$modelValue),h.$setViewValue(h.$modelValue),n=!1);var a=new Date,b=angular.copy(a),c=angular.copy(a);b.setHours(j.val()),b.setMinutes(k.val()),c.setHours(l.val()),c.setMinutes(m.val()),c>b?(e.$setValidity("poaOK",!0),f.$setValidity("poaOK",!0),g.$setValidity("poaOK",!0),h.$setValidity("poaOK",!0)):(e.$setValidity("poaOK",!1),f.$setValidity("poaOK",!1),g.$setValidity("poaOK",!1),h.$setValidity("poaOK",!1))};j.on("change",o),k.on("change",o),l.on("change",o),m.on("change",o)}}}]),angular.module("fancheerEMC").directive("checkUsername",["$resource",function(a){return{restrict:"AC",require:"ngModel",link:function(b,c,d,e){var f=a("api/sooa/usernames/:username",{username:"@username"});c.on("keyup",function(){if(c.val().length>=4){var a=new f({username:c.val()});a.$get(function(){b.usernameValidLength=c.val()&&c.val().length>=4&&c.val().length<=20?"valid":void 0,b.usernameUnique="usernameNotFound"===a.text?"valid":void 0,b.usernameValidLength&&b.usernameUnique?e.$setValidity("username",!0):e.$setValidity("username",!1)},function(){})}else b.usernameValidLength=void 0,b.usernameUnique=void 0,e.$setValidity("username",!1)})}}}]),angular.module("fancheerEMC").directive("checkEmail",["$resource",function(a){return{restrict:"AC",require:"ngModel",link:function(b,c,d,e){var f=a("api/sooa/emails/:email",{email:"@email"}),g=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/;c.on("keyup",function(){if(0!==c.val().length&&g.test(c.val())){var a=new f({email:c.val()});a.$get(function(){b.emailUnique="emailNotFound"===a.text?"valid":void 0,b.emailValid=g.test(c.val())?"valid":void 0,b.emailUnique&&b.emailValid?e.$setValidity("email",!0):e.$setValidity("email",!1)},function(){})}else b.emailUnique=void 0,b.emailValid=void 0,e.$setValidity("email",!1)})}}}]),angular.module("fancheerEMC").directive("checkEmployer",[function(){return{require:"ngModel",link:function(a,b,c,d){var e="#"+c.igCheckEmployer;b.add(e).on("keyup",function(){a.$apply(function(){var a=b.val()===$(firstPassword).val();d.$setValidity("noMatch",a)})})}}}]),angular.module("fancheerEMC").controller("ForgottenCtrl",["$scope","$resource",function(a,b){var c=b("api/sooa/accounts/passwordreset",{username:"@username"});a.requestResetPassword=function(){var b=new c;b.username=a.username,b.$save(function(){"resetRequestProcessed"===b.text&&(a.username="")})}}]),angular.module("fancheerEMC").controller("RegistrationCtrl",["$scope","$resource","$modal","$location",function(a,b,c,d){a.account={},a.registered=!1,a.agreed=!0;var e=(b("api/sooa/usernames/:username",{username:"@username"}),b("api/sooa/emails/:email",{email:"@email"}),b("api/sooa/accounts/register"));a.registerAccount=function(){if(a.agreed){var b=new e;b.accountType="customer",b.venue=a.account.venue,b.fullName=a.account.fullName,b.phone=a.account.phone,b.username=a.account.username,b.password=a.account.password,b.email=a.account.email,b.signedConfidentialityAgreement=!0,b.$save(function(){"userAdded"===b.text&&(a.account={},a.registered=!0,d.path("/registrationSubmitted"))},function(){a.registered=!1}),a.registered=!0}}}]),angular.module("fancheerEMC").controller("AccountCtrl",["$scope","$resource","AccountLoader","Account","userInfoService","$location","PasswordChange","$http",function(a,b,c,d,e,f,g,h){a.accountpwd={},a.initModel=function(b){a.account=b,a.accountOrig=angular.copy(a.account)},a.updateAccount=function(){new d(a.account).$save(),a.accountOrig=angular.copy(a.account)},a.resetForm=function(){a.account=angular.copy(a.accountOrig)},a.isUnchanged=function(b){return angular.equals(b,a.accountOrig)},a.changePassword=function(){var b=angular.fromJson({username:a.account.username,password:a.accountpwd.currentPassword,newPassword:a.accountpwd.newPassword,id:a.account.id});new g(b).$save()},a.deleteAccount=function(){var b=new d;b.id=a.account.id,b.$remove(function(){e.setCurrentUser(null),a.$emit("event:logoutRequest"),f.url("/console")})},c(e.getAccountID()).then(function(b){a.initModel(b),a.$$phase||a.$apply()},function(){})}]),angular.module("fancheerEMC").controller("RegisterResetPasswordCtrl",["$scope","$resource","$modal","$routeParams","isFirstSetup",function(a,b,c,d,e){a.agreed=!1,a.displayForm=!0,a.isFirstSetup=e,angular.isDefined(d.username)||(a.displayForm=!1),""===d.username&&(a.displayForm=!1),angular.isDefined(d.token)||(a.displayForm=!1),""===d.token&&(a.displayForm=!1),angular.isDefined(d.userId)||(a.displayForm=!1),""===d.userId&&(a.displayForm=!1);var f=(b("api/sooa/accounts/register/:userId/passwordreset",{userId:"@userId",token:"@token"}),b("api/sooa/accounts/:id/passwordreset",{id:"@userId",token:"@token"}));a.user={},a.user.username=d.username,a.user.newUsername=d.username,a.user.userId=d.userId,a.user.token=d.token,a.changePassword=function(){if(a.agreed){var b=new f(a.user);b.$save(function(){a.user.password="",a.user.passwordConfirm=""})}}}]),angular.module("fancheerEMC").factory("Account",["$resource",function(a){return a("api/accounts/:id",{id:"@id"})}]),angular.module("fancheerEMC").factory("PasswordChange",["$resource",function(a){return a("api/accounts/:id/passwordchange",{id:"@id"})}]),angular.module("fancheerEMC").factory("LoginService",["$resource","$q",function(a,b){return function(){var c=a("api/accounts/login"),d=b.defer();return c.get({},function(a){d.resolve(a)}),d.promise}}]),angular.module("fancheerEMC").factory("AccountLoader",["Account","$q",function(a,b){return function(c){var d=b.defer();return a.get({id:c},function(a){d.resolve(a)},function(){d.reject("Unable to fetch account")}),d.promise}}]);